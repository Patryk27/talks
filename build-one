#!/usr/bin/env bash

set -e

PRESENTATION=$1

if [[ -z "$PRESENTATION" ]]; then
    echo "error: missing presentation name"
    exit 1
fi

echo "[+] Building \`$PRESENTATION\`"

docker run \
    --rm \
    -v "$(pwd)/$PRESENTATION:/mnt/src:" \
    -v "$(pwd)/_assets:/mnt/_assets" \
    -u `id -u $USER` \
    asciidoctor-pdf \
        ./presentation.adoc \
        --template-require ./template.js \
        -r asciidoctor-kroki

mkdir "$PRESENTATION.out"
mv "$PRESENTATION/presentation.html" "$PRESENTATION.out/$PRESENTATION.html"
mv "$PRESENTATION/presentation.pdf" "$PRESENTATION.out/$PRESENTATION.pdf"

# HTML files generated by `asciidoctor-pdf.js` contain references to `/mnt`,
# which we have to get rid ofm if we want the HTMLs to be actually usable
sed -i 's/\/mnt\///g' "presentation.html"
